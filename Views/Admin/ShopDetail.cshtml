@{
    Layout = "_LayoutAdmin";
    ViewBag.Title = "Chi ti·∫øt c·ª≠a h√†ng";
}

<!-- Start Page Content -->

<div class="page-content">
  <!-- Start Container Fluid -->

  <div class="container-xxl">
    <div class="row">
      <div class="col-12">
        <!-- Th√¥ng tin shop -->

        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-lg-4">
                <div class="d-flex align-items-center">
                  <div class="flex-shrink-0">
                    <img
                      src="assets/images/users/avatar-2.jpg"
                      alt=""
                      class="avatar-xl rounded"
                    />
                  </div>

                  <div class="flex-grow-1 ms-3">
                    <h4 class="mb-1">C·ª≠a H√†ng N√¥ng S·∫£n S·∫°ch</h4>

                    <p class="text-muted mb-1">
                      <i class="bx bx-map-pin me-1"></i>123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1,
                      TP.HCM
                    </p>

                    <p class="text-muted mb-0">
                      <i class="bx bx-phone me-1"></i>0987654321
                    </p>
                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="mt-4 mt-lg-0">
                  <div class="row">
                    @* <div class="col-md-6">
                      <div class="mt-3">
                        <p class="text-muted mb-2">ƒê√°nh Gi√° Shop</p>

                        <h5 class="mb-0">
                          4.8 <i class="bx bxs-star text-warning"></i>
                        </h5>
                      </div>
                    </div> *@

                    <div class="col-md-6">
                      <div class="mt-3">
                        <p class="text-muted mb-2">Lo·∫°i shop</p>
                        <h5 class="mb-0" id="shop-type"></h5>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="mt-4 mt-lg-0">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mt-3">
                        <p class="text-muted mb-2">Th·ªùi Gian Ph·∫£n H·ªìi</p>

                        <h5 class="mb-0">Trong v√≤ng 24h</h5>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="mt-3">
                        <p class="text-muted mb-2">Ng√†y Tham Gia</p>
                        <h5 class="mb-0" id="date-joined">01/01/2024</h5>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Th·ªëng k√™ -->

        <div class="row">
          <div class="col-xl-3 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="flex-grow-1">
                    <h4 class="mb-2 fw-semibold">T·ªïng S·∫£n Ph·∫©m</h4>
                  </div>

                  <div class="flex-shrink-0">
                    <div class="avatar-sm">
                      <span
                        class="avatar-title bg-primary-subtle text-primary rounded-circle fs-3"
                      >
                        <i class="bx bx-package"></i>
                      </span>
                    </div>
                  </div>
                </div>

                <div class="pt-4">
                  <h2 class="counter-value" data-target="156">156</h2>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="flex-grow-1">
                    <h4 class="mb-2 fw-semibold">S·∫£n Ph·∫©m H·∫øt H√†ng</h4>
                  </div>

                  <div class="flex-shrink-0">
                    <div class="avatar-sm">
                      <span
                        class="avatar-title bg-danger-subtle text-danger rounded-circle fs-3"
                      >
                        <i class="bx bx-x-circle"></i>
                      </span>
                    </div>
                  </div>
                </div>

                <div class="pt-4">
                  <h2 class="counter-value" data-target="8">8</h2>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="flex-grow-1">
                    <h4 class="mb-2 fw-semibold">T·ªïng s·ªë ƒë∆°n h√†ng</h4>
                  </div>

                  <div class="flex-shrink-0">
                    <div class="avatar-sm">
                      <span
                        class="avatar-title bg-success-subtle text-success rounded-circle fs-3"
                      >
                        <i class="bx bx-trending-up"></i>
                      </span>
                    </div>
                  </div>
                </div>

                <div class="pt-4">
                  <h2 class="counter-value" data-target="32">32</h2>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="flex-grow-1">
                    <h4 class="mb-2 fw-semibold">Doanh Thu</h4>
                  </div>

                  <div class="flex-shrink-0">
                    <div class="avatar-sm">
                      <span
                        class="avatar-title bg-info-subtle text-info rounded-circle fs-3"
                      >
                        <i class="bx bx-money"></i>
                      </span>
                    </div>
                  </div>
                </div>

                <div class="pt-4">
                  <h2 class="counter-value">32.189.000ƒë</h2>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header d-flex align-items-center">
            <h5 class="card-title flex-grow-1 mb-0">Danh S√°ch S·∫£n Ph·∫©m</h5>

            <div class="flex-shrink-0">
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-soft-primary btn-sm">
                  <i class="bx bx-export me-1"></i> Xu·∫•t Excel
                </button>

                <button type="button" class="btn btn-primary btn-sm">
                  <i class="bx bx-plus me-1"></i> Th√™m S·∫£n Ph·∫©m
                </button>
              </div>
            </div>
          </div>

          <div class="card-body">
            <!-- Th√™m b·ªô t√¨m ki·∫øm v√† l·ªçc -->
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
                    id="product-search-input"
                  />
                  <button class="btn btn-primary" type="button" id="product-search-button">
                    <i class="bx bx-search"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-6 text-end">
                <button
                  type="button"
                  class="btn btn-outline-secondary me-1"
                  data-bs-toggle="modal"
                  data-bs-target="#filterModal"
                >
                  <i class="bx bx-filter-alt me-1"></i> L·ªçc
                </button>
                <button type="button" class="btn btn-outline-danger me-1" id="reset-filter-button">
                  <i class="bx bx-reset me-1"></i> Reset
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table align-middle mb-0 table-hover table-centered">
                <thead class="bg-light-subtle">
                  <tr>
                    <th style="width: 20px">
                      <div class="form-check ms-1">
                        <input
                          type="checkbox"
                          class="form-check-input"
                          id="select-all-checkbox"
                        />
                        <label
                          class="form-check-label"
                          for="customCheck1"
                        ></label>
                      </div>
                    </th>
                    <th>T√™n S·∫£n Ph·∫©m & Th√¥ng Tin</th>
                    <th>Gi√°</th>
                    <th>T·ªìn Kho</th>
                    <th>Danh M·ª•c</th>
                    <th>ƒê√°nh Gi√°</th>
                    <th>Thao T√°c</th>
                  </tr>
                </thead>
                <tbody id="product-table-body">
                  <!-- JavaScript s·∫Ω t·∫°o ra c√°c d√≤ng d·ªØ li·ªáu t·∫°i ƒë√¢y -->
                </tbody>
              </table>
            </div>
            <!-- end table-responsive -->
          </div>
          <div class="card-footer border-top">
            <div id="paging-count"></div>
            <nav aria-label="Page navigation example">
              <ul class="pagination justify-content-end mb-0" id="paging-list">
                <li class="page-item">
                  <a class="page-link" href="javascript:void(0);" id="btn-prev">Tr∆∞·ªõc</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="javascript:void(0);" id="btn-next">Sau</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- End Container Fluid -->
</div>

<!-- Modal L·ªçc -->
<div
  class="modal fade"
  id="filterModal"
  tabindex="-1"
  aria-labelledby="filterModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="filterModalLabel">L·ªçc S·∫£n Ph·∫©m</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label class="form-label">Danh M·ª•c</label>
            <select class="form-select" id="category-filter">
              <option value="-999">T·∫•t c·∫£</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Xu·∫•t X·ª©</label>
            <select class="form-select" id="origin-filter">
              <option value="-999">T·∫•t c·∫£</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Gi√° (VNƒê)</label>
            <div class="row">
              <div class="col-6">
                <input type="number" class="form-control" placeholder="T·ª´" id="min-price-filter" />
              </div>
              <div class="col-6">
                <input type="number" class="form-control" placeholder="ƒê·∫øn" id="max-price-filter" />
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">T√¨nh Tr·∫°ng Kho</label>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                id="inStock"
                name="stock-status"
                checked
              />
              <label class="form-check-label" for="inStock"> C√≤n h√†ng </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" id="outOfStock" name="stock-status" />
              <label class="form-check-label mt-1" for="outOfStock">
                H·∫øt h√†ng
              </label>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">S·∫Øp X·∫øp Theo</label>
            <select class="form-select" id="sort-by-filter">
              <option value="0">M·∫∑c ƒë·ªãnh</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">
          H·ªßy
        </button>
        <button type="button" class="btn btn-primary" id="apply-filter-button">√Åp D·ª•ng</button>
      </div>
    </div>
  </div>
</div>

<!-- End Page Content -->
<script type="module">
    import { BaseService } from "/custom/BaseService.js";
    import createFilterProduct from "/custom/filterProduct.js";
    import { SortType } from "/custom/Enum.js";
    import { EnumService } from "/custom/EnumService.js";
    import key from "/custom/jwt.js";
    import url from "/Custom/endpoints.js";
  
    const jwt = key;
    const enumService = new EnumService(url.baseUrl, jwt);
    const productService = new BaseService(
      url.base + "/Product",
      jwt
    );
    const categoryService = new BaseService(
      url.base + "/Category",
      jwt
    );
    const storeService = new BaseService(
        url.base + "/Store",
        jwt
    );
    
    
    
    const appProduct = {
      filter: new createFilterProduct({
        searchTerm: "",
        sortBy: SortType.Latest,
        page: 1,
        pageSize: 10,
        minPrice: 0,
        maxPrice: 10000000,
        categoryId: -999,
        origin: "",
        isActive: null,
        isInStock: null,
        unit: -999,
        storeId: null
      }),
      appliedFilters: {},
      categories: [],
      origins: [],
      units: {},
      init: function (storeId) {
        this.filter.storeId = storeId;
        this.loadCategories();
        this.loadOrigins();
        this.loadUnits();
        this.loadSortType();
        this.handleFilterFunction();
        this.handleResetFilter();
        this.handleApplyFilter();
        this.handleSearchFunction();
        this.handlePagingFunction();
        this.handleSelectAll();
        this.loadStatistics();
        this.initializeFilters();
  
        // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
        this.applyFilter();
      },
  
      initializeFilters: function () {
        // Kh·ªüi t·∫°o gi√° tr·ªã m·∫∑c ƒë·ªãnh cho c√°c b·ªô l·ªçc
        this.updateAppliedFiltersDisplay();
      },

      loadStatistics: function () {
        const _this = this;
        storeService.fetchApi(`/${_this.filter.storeId}/get-statistics-store`, 'GET').then(response => {
          console.log("Response statistics:", response);
          let cards = document.querySelectorAll('.counter-value');
            let i = 0;
            for(let key in response.data){
              console.log("Key:", key);
              if(i == 3){
                cards[i].textContent = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(response.data[key]);
                break;
              }else{
                cards[i].textContent = response.data[key];
              }
              i++;
            }
        });
      },
  
      applyFilter: function () {
        const _this = this;
  
        productService
          .find(_this.filter)
          .then((data) => {
            console.log("Product data:", data);
            if (data && data.success) {
              const items = data.data || [];
              _this.reloadTable(items);
  
              // C·∫≠p nh·∫≠t ph√¢n trang
              const start = (_this.filter.page - 1) * _this.filter.pageSize + 1;
              const end = start + items.length - 1;
              const totalCount = data.totalCount || 0;

              let text = '';
              if(totalCount == 0){
                text = 'Kh√¥ng c√≥ d·ªØ li·ªáu';
              }else{
                text = `Hi·ªÉn th·ªã ${start} - ${end}/${totalCount} s·∫£n ph·∫©m`;
              }
  
              document.getElementById(
                "paging-count"
              ).textContent = text;
  
              // C·∫≠p nh·∫≠t danh s√°ch ph√¢n trang
              const pagingList = document.getElementById("paging-list");
              pagingList.innerHTML = `
                <li class="page-item" id="btn-prev">
                  <a href="#" class="page-link"><i class="bx bx-left-arrow-alt"></i></a>
                </li>`;
  
              const totalPages = Math.ceil(totalCount / _this.filter.pageSize);
  
              for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement("li");
                li.classList.add("page-item");
  
                if (i === _this.filter.page) {
                  li.classList.add("active");
                }
  
                li.addEventListener("click", () => {
                  _this.filter.page = i;
                  _this.applyFilter();
                });
  
                const a = document.createElement("a");
                a.classList.add("page-link");
                a.textContent = i;
                a.href = "#";
  
                li.appendChild(a);
                pagingList.appendChild(li);
              }
  
              pagingList.innerHTML += `
                <li class="page-item" id="btn-next">
                  <a href="#" class="page-link"><i class="bx bx-right-arrow-alt"></i></a>
                </li>`;
  
              // V√¥ hi·ªáu h√≥a n√∫t Prev n·∫øu ƒëang ·ªü trang ƒë·∫ßu ti√™n
              if (_this.filter.page === 1) {
                document.getElementById("btn-prev").classList.add("disabled");
              }
  
              // V√¥ hi·ªáu h√≥a n√∫t Next n·∫øu ƒëang ·ªü trang cu·ªëi c√πng
              if (_this.filter.page === totalPages) {
                document.getElementById("btn-next").classList.add("disabled");
              }
            } else {
              // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
              document.getElementById("product-table-body").innerHTML = `
                <tr>
                  <td colspan="7" class="text-center text-danger">
                    Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m. Vui l√≤ng th·ª≠ l·∫°i sau.
                  </td>
                </tr>`;
  
              document.getElementById("paging-count").textContent =
                "Kh√¥ng c√≥ d·ªØ li·ªáu";
            }
          })
          .catch((error) => {
            console.error("Error retrieving products:", error);
            document.getElementById("product-table-body").innerHTML = `
              <tr>
                <td colspan="7" class="text-center text-danger">
                  ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i sau.
                </td>
              </tr>`;
  
            document.getElementById("paging-count").textContent = "ƒê√£ x·∫£y ra l·ªói";
          });
      },
  
      loadCategories: function () {
        // Load danh m·ª•c v√†o dropdown
        const categoryDropdown = document.getElementById("category-filter");
        categoryDropdown.innerHTML =
          "<option value='-999' selected>T·∫•t c·∫£</option>";
  
        categoryService
          .getAll()
          .then((data) => {
            if (data && data.success) {
              const items = data.data || [];
              this.categories = items;
  
              items.forEach((item) => {
                const option = document.createElement("option");
                option.value = item.id;
                option.textContent = item.name;
                categoryDropdown.appendChild(option);
              });
            }
          })
          .catch((error) => {
            console.error("Error retrieving categories:", error);
          });
      },
  
      loadOrigins: function () {
        // Load xu·∫•t x·ª© v√†o dropdown
        const originDropdown = document.getElementById("origin-filter");
        originDropdown.innerHTML = "<option value=''>T·∫•t c·∫£</option>";
  
        enumService
          .getOriginTypes()
          .then((data) => {
            if (data) {
              this.origins = data;
  
              data.forEach((origin) => {
                const option = document.createElement("option");
                option.value = origin;
                option.textContent = origin;
                originDropdown.appendChild(option);
              });
            }
          })
          .catch((error) => {
            console.error("Error retrieving origins:", error);
          });
      },
      
      loadUnits: function () {
        enumService.getUnitTypes().then((data) => {
          if (data) {
            this.units = data;
          }
        })
        .catch((error) => {
          console.error("Error retrieving units:", error);
        });
      },
  
      loadSortType: function () {
        const sortByDropdown = document.getElementById("sort-by-filter");
        sortByDropdown.innerHTML = "";
  
        enumService
          .getSortTypesByEntity("Product")
          .then((data) => {
            if (data) {
              Object.keys(data).forEach((key) => {
                const option = document.createElement("option");
                option.value = key;
                option.textContent = data[key];
                sortByDropdown.appendChild(option);
              });
            }
          })
          .catch((error) => {
            console.error("Error retrieving sort types:", error);
            // Th√™m c√°c gi√° tr·ªã m·∫∑c ƒë·ªãnh n·∫øu API th·∫•t b·∫°i
            const defaultSortOptions = [
              { value: "0", text: "M·∫∑c ƒë·ªãnh" },
              { value: "0", text: "Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu" },
            ];
  
            defaultSortOptions.forEach((option) => {
              const optionElement = document.createElement("option");
              optionElement.value = option.value;
              optionElement.textContent = option.text;
              sortByDropdown.appendChild(optionElement);
            });
          });
      },
  
      handleFilterFunction: function () {
        // S·ª± ki·ªán khi b·∫•m n√∫t l·ªçc tr√™n giao di·ªán ch√≠nh
        const filterButton = document.querySelector(
          "[data-bs-target='#filterModal']"
        );
        const _this = this;
  
        filterButton.addEventListener("click", () => {
          // C·∫≠p nh·∫≠t c√°c gi√° tr·ªã trong modal filter t·ª´ filter hi·ªán t·∫°i
          _this.updateFilterModal();
        });
      },
  
      updateFilterModal: function () {
        // C·∫≠p nh·∫≠t gi√° tr·ªã trong modal t·ª´ filter hi·ªán t·∫°i
        const categoryDropdown = document.getElementById("category-filter");
        const originDropdown = document.getElementById("origin-filter");
        const minPriceInput = document.getElementById("min-price-filter");
        const maxPriceInput = document.getElementById("max-price-filter");
        const stockRadios = document.querySelectorAll("[name='stock-status']");
        const sortByDropdown = document.getElementById("sort-by-filter");
  
        // ƒê·∫∑t gi√° tr·ªã cho t·ª´ng tr∆∞·ªùng
        if (this.filter.categoryId !== -999) {
          categoryDropdown.value = this.filter.categoryId;
        } else {
          categoryDropdown.value = -999;
        }
  
        if (this.filter.origin) {
          originDropdown.value = this.filter.origin;
        } else {
          originDropdown.value = "";
        }
  
        minPriceInput.value =
          this.filter.minPrice > 0 ? this.filter.minPrice : "";
        maxPriceInput.value =
          this.filter.maxPrice < 10000000 ? this.filter.maxPrice : "";
  
        // C·∫≠p nh·∫≠t radio buttons t·ªìn kho
        if (this.filter.isInStock === true) {
          document.getElementById("inStock").checked = true;
        } else if (this.filter.isInStock === false) {
          document.getElementById("outOfStock").checked = true;
        } 
  
        // C·∫≠p nh·∫≠t sort by
        if (
          sortByDropdown.querySelector(`option[value="${this.filter.sortBy}"]`)
        ) {
          sortByDropdown.value = this.filter.sortBy;
        }
      },
  
      handleResetFilter: function () {
        const resetButton = document.getElementById("reset-filter-button");
        const _this = this;
  
        resetButton.addEventListener("click", () => {
          // Reset filter v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh
          _this.filter = new createFilterProduct({
            searchTerm: "",
            sortBy: SortType.Latest,
            page: 1,
            pageSize: 10,
            minPrice: 0,
            maxPrice: 10000000,
            categoryId: -999,
            origin: "",
            isActive: null,
            isInStock: null,
            unit: -999,
            storeId: _this.filter.storeId
          });
  
          // Reset √¥ t√¨m ki·∫øm
          document.getElementById("product-search-input").value = "";
  
          // C·∫≠p nh·∫≠t l·∫°i UI
          _this.updateAppliedFiltersDisplay();
          _this.applyFilter();
        });
      },
  
      handleApplyFilter: function () {
        const applyButton = document.getElementById("apply-filter-button");
        const _this = this;
  
        applyButton.addEventListener("click", () => {
          // L·∫•y gi√° tr·ªã t·ª´ c√°c tr∆∞·ªùng trong modal
          const categoryId = document.getElementById("category-filter").value;
          const origin = document.getElementById("origin-filter").value;
          const minPrice = document.getElementById("min-price-filter").value;
          const maxPrice = document.getElementById("max-price-filter").value;
          const isStock = document.getElementById("inStock").checked;
          const sortBy = document.getElementById("sort-by-filter").value;
  
          // C·∫≠p nh·∫≠t filter
          if (categoryId) {
            _this.filter.categoryId = parseInt(categoryId);
          }
  
          if (origin) {
            _this.filter.origin = origin;
          } else {
            _this.filter.origin = "";
          }
  
          if (minPrice) {
            _this.filter.minPrice = parseInt(minPrice);
          } else {
            _this.filter.minPrice = 0;
          }
  
          if (maxPrice) {
            _this.filter.maxPrice = parseInt(maxPrice);
          } else {
            _this.filter.maxPrice = 10000000;
          }
          console.log(isStock)
          if (isStock) {
            _this.filter.isInStock = true;
          } else {
            _this.filter.isInStock = false;
          }
  
          if (sortBy) {
            _this.filter.sortBy = parseInt(sortBy);
          }
  
          // Reset trang v·ªÅ 1
          _this.filter.page = 1;
  
          // ƒê√≥ng modal
          const filterModal = bootstrap.Modal.getInstance(
            document.getElementById("filterModal")
          );
          filterModal.hide();
  
          // C·∫≠p nh·∫≠t hi·ªÉn th·ªã b·ªô l·ªçc ƒë√£ √°p d·ª•ng
          _this.updateAppliedFiltersDisplay();
  
          // √Åp d·ª•ng b·ªô l·ªçc
          _this.applyFilter();
        });
      },
  
      updateAppliedFiltersDisplay: function () {
        // Kh√¥ng c·∫ßn code v√¨ ƒë√£ t·∫°o static trong HTML
      },
  
      handleSearchFunction: function () {
        const searchInput = document.getElementById("product-search-input");
        const searchButton = document.getElementById("product-search-button");
        const _this = this;
  
        // X·ª≠ l√Ω khi nh·∫•n n√∫t t√¨m ki·∫øm
        searchButton.addEventListener("click", () => {
          _this.filter.searchTerm = searchInput.value;
          _this.filter.page = 1; // Reset v·ªÅ trang 1
          _this.updateAppliedFiltersDisplay();
          _this.applyFilter();
        });
  
        // X·ª≠ l√Ω khi nh·∫•n Enter trong √¥ t√¨m ki·∫øm
        searchInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            _this.filter.searchTerm = searchInput.value;
            _this.filter.page = 1; // Reset v·ªÅ trang 1
            _this.updateAppliedFiltersDisplay();
            _this.applyFilter();
            e.preventDefault();
          }
        });
      },
  
      handlePagingFunction: function () {
        const _this = this;
  
        // S·ª± ki·ªán cho n√∫t Previous
        document.addEventListener("click", function (e) {
          if (
            e.target.closest("#btn-prev") &&
            !e.target.closest("#btn-prev").classList.contains("disabled")
          ) {
            e.preventDefault();
            if (_this.filter.page > 1) {
              _this.filter.page--;
              _this.applyFilter();
            }
          }
        });
  
        // S·ª± ki·ªán cho n√∫t Next
        document.addEventListener("click", function (e) {
          if (
            e.target.closest("#btn-next") &&
            !e.target.closest("#btn-next").classList.contains("disabled")
          ) {
            e.preventDefault();
            _this.filter.page++;
            _this.applyFilter();
          }
        });
      },
  
      handleSelectAll: function () {
        const selectAllCheckbox = document.getElementById("select-all-checkbox");
  
        selectAllCheckbox.addEventListener("change", () => {
          const isChecked = selectAllCheckbox.checked;
          const checkboxes = document.querySelectorAll(
            "#product-table-body .form-check-input"
          );
  
          checkboxes.forEach((checkbox) => {
            checkbox.checked = isChecked;
          });
        });
      },
  
      reloadTable: function (items) {
        const tableBody = document.getElementById("product-table-body");
        tableBody.innerHTML = "";
  
        if (!items || items.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="7" class="text-center">
                Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p v·ªõi ƒëi·ªÅu ki·ªán t√¨m ki·∫øm.
              </td>
            </tr>`;
          return;
        }
  
        items.forEach((product) => {
          // T·∫°o m·ªôt h√†ng m·ªõi cho b·∫£ng
          const row = document.createElement("tr");
  
          // T·∫°o √¥ checkbox
          const checkboxCell = document.createElement("td");
          checkboxCell.innerHTML = `
            <div class="form-check ms-1">
              <input type="checkbox" class="form-check-input" id="product-${product.id}">
              <label class="form-check-label" for="product-${product.id}">&nbsp;</label>
            </div>
          `;
  
          // T·∫°o √¥ th√¥ng tin s·∫£n ph·∫©m
          const productInfoCell = document.createElement("td");
          productInfoCell.innerHTML = `
            <div class="d-flex align-items-center gap-2">
              <div class="rounded bg-light avatar-md d-flex align-items-center justify-content-center">
                <img src="${url.baseUrl}/img/Products/${product.imageUrl}" alt="" class="avatar-md" onerror="this.src='/custom/no-image.webp'">
              </div>
              <div>
                <a href="#!" class="text-dark fw-medium fs-15">${product.name}</a>
                <p class="text-muted mb-0 mt-1 fs-13">
                  <span>Xu·∫•t x·ª©: </span>${product.origin || "Kh√¥ng c√≥ th√¥ng tin"}
                  <br>
                  <span>ƒê∆°n v·ªã: </span>${this.units[product.unit] || "Kh√¥ng c√≥ th√¥ng tin"}
                </p>
              </div>
            </div>
          `;
  
          // T·∫°o √¥ gi√°
          const priceCell = document.createElement("td");
          priceCell.textContent = new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND",
          }).format(product.price);
  
          // T·∫°o √¥ t·ªìn kho
          const stockCell = document.createElement("td");
          stockCell.innerHTML = `
            <p class="mb-1 text-muted">
              <span class="text-dark fw-medium">${product.stockQuantity} ${
            this.units[product.unit] || "ƒëvt"
          }</span> 
            </p>
          `;
  
          // T·∫°o √¥ danh m·ª•c
          const categoryCell = document.createElement("td");
          categoryCell.textContent = this.getCategoryName(product.categoryId);
  
          // T·∫°o √¥ ƒë√°nh gi√°
          const ratingCell = document.createElement("td");
          ratingCell.innerHTML = `
            <a class="badge p-1 bg-light text-dark fs-12 me-1" href="/Admin/ProductReview?id=${product.id}">
              <i class="bx bxs-star align-text-top fs-14 text-warning me-1"></i>
              ${product.averageRating?.toFixed(1) || "N/A"}
            </a>
            ${product.reviewCount || 0} ƒê√°nh gi√°
          `;
  
          // T·∫°o √¥ thao t√°c
          const actionCell = document.createElement("td");
          actionCell.innerHTML = `
            <div class="d-flex gap-2">
              <a href="@Url.Action("ProductDetail", "Admin", new { id = 3 })" class="btn btn-light btn-sm view-product" data-id="${product.id}">
                <iconify-icon icon="solar:eye-broken" class="align-middle fs-18"></iconify-icon>
              </a>
              <a href="/Admin/ProductEdit?id=${product.id}" class="btn btn-soft-primary btn-sm edit-product" data-id="${product.id}">
                <iconify-icon icon="solar:pen-2-broken" class="align-middle fs-18"></iconify-icon>
              </a>
              <a href="#!" class="btn btn-soft-danger btn-sm delete-product" data-id="${product.id}">
                <iconify-icon icon="solar:trash-bin-minimalistic-2-broken" class="align-middle fs-18"></iconify-icon>
              </a>
            </div>
          `;
  
          // Th√™m c√°c √¥ v√†o h√†ng
          row.appendChild(checkboxCell);
          row.appendChild(productInfoCell);
          row.appendChild(priceCell);
          row.appendChild(stockCell);
          row.appendChild(categoryCell);
          row.appendChild(ratingCell);
          row.appendChild(actionCell);
  
          // Th√™m h√†ng v√†o b·∫£ng
          tableBody.appendChild(row);
        });
  
        // Th√™m s·ª± ki·ªán cho c√°c n√∫t trong b·∫£ng
        this.addTableEventListeners();
      },
  
      getCategoryName: function (categoryId) {
        const category = this.categories.find((c) => c.id === categoryId);
        return category ? category.name : "Kh√¥ng ph√¢n lo·∫°i";
      },
  
      addTableEventListeners: function () {
        // S·ª± ki·ªán cho n√∫t xem chi ti·∫øt
        document.querySelectorAll(".view-product").forEach((button) => {
          button.addEventListener("click", (e) => {
            e.preventDefault();
            const productId = button.getAttribute("data-id");
            window.location.href = `/Admin/ProductDetail?id=${productId}`;
          });
        });
  
        // S·ª± ki·ªán cho n√∫t s·ª≠a
        document.querySelectorAll(".edit-product").forEach((button) => {
          button.addEventListener("click", (e) => {
            e.preventDefault();
            const productId = button.getAttribute("data-id");
            window.location.href = `/Admin/ProductEdit?id=${productId}`;
          });
        });
  
        // S·ª± ki·ªán cho n√∫t x√≥a
        document.querySelectorAll(".delete-product").forEach((button) => {
          button.addEventListener("click", (e) => {
            e.preventDefault();
            const productId = button.getAttribute("data-id");
  
            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")) {
              productService
                .delete(productId)
                .then((response) => {
                  if (response && response.success) {
                    alert("X√≥a s·∫£n ph·∫©m th√†nh c√¥ng!");
                    this.applyFilter(); // T·∫£i l·∫°i danh s√°ch
                  } else {
                    alert(
                      "X√≥a s·∫£n ph·∫©m th·∫•t b·∫°i: " +
                        (response.message || "Kh√¥ng r√µ l·ªói")
                    );
                  }
                })
                .catch((error) => {
                  console.error("L·ªói khi x√≥a s·∫£n ph·∫©m:", error);
                  alert("ƒê√£ x·∫£y ra l·ªói khi x√≥a s·∫£n ph·∫©m. Vui l√≤ng th·ª≠ l·∫°i sau.");
                });
            }
          });
        });
      },
    };
    
    const appStore = {
        init: function(storeId){
            this.storeId = storeId;
            this.loadStoreInfo();
        },
        loadStoreInfo: function(){
            storeService.getById(this.storeId)
                .then(response => {
                    if(response && response.success && response.data) {
                        const store = response.data;
                        console.log(store);
                        
                        // C·∫≠p nh·∫≠t th√¥ng tin c·ª≠a h√†ng
                        document.querySelector('.card-body .flex-grow-1 h4').textContent = store.name;
                        document.querySelector('.card-body .flex-grow-1 p:nth-child(2)').innerHTML = 
                            `<i class="bx bx-map-pin me-1"></i>${store.address || 'Ch∆∞a c·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ'}`;
                        document.querySelector('.card-body .flex-grow-1 p:nth-child(3)').innerHTML = 
                            `<i class="bx bx-phone me-1"></i>${store.phoneNumber || 'Ch∆∞a c·∫≠p nh·∫≠t SƒêT'}`;
                        
                        // C·∫≠p nh·∫≠t avatar c·ª≠a h√†ng
                        const avatarImg = document.querySelector('.card-body .flex-shrink-0 img');
                        if(store.logoUrl) {
                            avatarImg.src = `${url.baseUrl}/img/Stores/${store.logoUrl}`;
                            avatarImg.onerror = function() {
                                this.src = '/custom/default.jpg';
                            }
                        }
                        
                        // C·∫≠p nh·∫≠t th√¥ng tin ƒë√°nh gi√°
                        @* document.querySelector('.col-md-6:nth-child(1) h5').innerHTML = 
                            `${store.averageRating ? store.averageRating.toFixed(1) : 'N/A'} <i class="bx bxs-star text-warning"></i>`; *@
                        
                        // C·∫≠p nh·∫≠t lo·∫°i shop
                        enumService.getShopTypes().then(response => {
                            if(response) {
                                const shopType = response[store.businessType];
                                document.querySelector('#shop-type').textContent = shopType ?? 'L·ªói Xƒê lo·∫°i shop';
                            }
                        });
                        // C·∫≠p nh·∫≠t th·ªùi gian ph·∫£n h·ªìi (kh√¥ng c√≥ trong d·ªØ li·ªáu API, gi·ªØ nguy√™n gi√° tr·ªã m·∫∑c ƒë·ªãnh)
                        
                        // C·∫≠p nh·∫≠t ng√†y tham gia
                        if(store.createdAt) {
                            const createdDate = new Date(store.createdAt);
                            const formattedDate = createdDate.toLocaleDateString('vi-VN');
                            document.querySelector('#date-joined').textContent = formattedDate;
                        }
                        
                        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng ƒë√°nh gi√°
                        @* if(store.reviewCount !== null && store.reviewCount !== undefined) {
                            const ratingElement = document.querySelector('.col-md-6:nth-child(1) p');
                            if(ratingElement) {
                                ratingElement.textContent = `ƒê√°nh Gi√° Shop (${store.reviewCount} l∆∞·ª£t)`;
                            }
                        } *@
                    } else {
                        console.error("Kh√¥ng th·ªÉ t·∫£i th√¥ng tin c·ª≠a h√†ng:", response?.message || "D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá");
                    }
                })
                .catch(error => {
                    console.error("L·ªói khi l·∫•y th√¥ng tin c·ª≠a h√†ng:", error);
                });
        }
    }

    // L·∫•y storeId t·ª´ tham s·ªë URL
    const urlParams = new URLSearchParams(window.location.search);
    const storeId = urlParams.get('id');
    // Ki·ªÉm tra n·∫øu kh√¥ng c√≥ storeId trong URL
    if (!storeId) {
      console.error("Kh√¥ng t√¨m th·∫•y id trong URL");
      // Chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng v·ªÅ trang index n·∫øu kh√¥ng c√≥ storeId
      window.location.href = "/Admin/Index";
      // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói (n·∫øu ng∆∞·ªùi d√πng kh√¥ng b·ªã chuy·ªÉn h∆∞·ªõng ngay l·∫≠p t·ª©c)
      document.body.innerHTML = `
        <div class="alert alert-danger text-center m-5" role="alert">
          <i class="bx bx-error-circle fs-3 me-2"></i> Kh√¥ng t√¨m th·∫•y th√¥ng tin c·ª≠a h√†ng. ƒêang chuy·ªÉn h∆∞·ªõng... ü•∫üëâüëà
        </div>
      `;
    }else{
        appProduct.init(parseInt(storeId));
        appStore.init(parseInt(storeId));
    }
  </script>
